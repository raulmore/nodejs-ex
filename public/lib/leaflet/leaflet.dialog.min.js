L.Control.Dialog=L.Control.extend({options:{size:[300,300],minSize:[100,100],maxSize:[350,350],anchor:[250,250],position:"topleft",initOpen:!0},initialize:function(i){L.setOptions(this,i),this._attributions={}},onAdd:function(i){return this._initLayout(),this._map=i,this.update(),this.options.initOpen||this.close(),this._container},open:function(){if(this._map)return this._container.style.visibility="",this._map.fire("dialog:opened",this),this},close:function(){return this._container.style.visibility="hidden",this._map.fire("dialog:closed",this),this},destroy:function(){var m=this._map;return m?(this.remove(),this.onRemove&&this.onRemove(m),m.fire("dialog:destroyed",this),this):this},setLocation:function(i){return i=i||[250,250],this.options.anchor[0]=0,this.options.anchor[1]=0,this._oldMousePos.x=0,this._oldMousePos.y=0,this._move(i[1],i[0]),this},setSize:function(i){return i=i||[300,300],this.options.size[0]=0,this.options.size[1]=0,this._oldMousePos.x=0,this._oldMousePos.y=0,this._resize(i[0],i[1]),this},lock:function(){return this._resizerNode.style.visibility="hidden",this._grabberNode.style.visibility="hidden",this._closeNode.style.visibility="hidden",this._map.fire("dialog:locked",this),this},unlock:function(){return this._resizerNode.style.visibility="",this._grabberNode.style.visibility="",this._closeNode.style.visibility="",this._map.fire("dialog:unlocked",this),this},freeze:function(){return this._resizerNode.style.visibility="hidden",this._grabberNode.style.visibility="hidden",this._map.fire("dialog:frozen",this),this},unfreeze:function(){return this._resizerNode.style.visibility="",this._grabberNode.style.visibility="",this._map.fire("dialog:unfrozen",this),this},setContent:function(i){return this._content=i,this.update(),this},getContent:function(){return this._content},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._container.style.visibility="",this._map.fire("dialog:updated",this))},_initLayout:function(){var i="leaflet-control-dialog",t=this._container=L.DomUtil.create("div",i);t.style.width=this.options.size[0]+"px",t.style.height=this.options.size[1]+"px",t.style.top=this.options.anchor[0]+"px",t.style.left=this.options.anchor[1]+"px";var e=L.DomEvent.stopPropagation;L.DomEvent.on(t,"click",e).on(t,"mousedown",e).on(t,"touchstart",e).on(t,"dblclick",e).on(t,"mousewheel",e).on(t,"contextmenu",e).on(t,"MozMousePixelScroll",e);var o=this._innerContainer=L.DomUtil.create("div",i+"-inner"),s=this._grabberNode=L.DomUtil.create("div",i+"-grabber"),n=L.DomUtil.create("i","fa fa-arrows");s.appendChild(n),L.DomEvent.on(s,"mousedown",this._handleMoveStart,this);var h=this._closeNode=L.DomUtil.create("div",i+"-close"),a=L.DomUtil.create("i","fa fa-times");h.appendChild(a),L.DomEvent.on(h,"click",this._handleClose,this);var r=this._resizerNode=L.DomUtil.create("div",i+"-resizer"),l=L.DomUtil.create("i","fa fa-arrows-h fa-rotate-45");r.appendChild(l),L.DomEvent.on(r,"mousedown",this._handleResizeStart,this);var d=this._contentNode=L.DomUtil.create("div",i+"-contents");t.appendChild(o),o.appendChild(d),o.appendChild(s),o.appendChild(h),o.appendChild(r),this._oldMousePos={x:0,y:0}},_handleClose:function(){this.close()},_handleResizeStart:function(i){this._oldMousePos.x=i.clientX,this._oldMousePos.y=i.clientY,L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this),L.DomEvent.on(this._map,"mouseup",this._handleMouseUp,this),this._map.fire("dialog:resizestart",this),this._resizing=!0},_handleMoveStart:function(i){this._oldMousePos.x=i.clientX,this._oldMousePos.y=i.clientY,L.DomEvent.on(this._map,"mousemove",this._handleMouseMove,this),L.DomEvent.on(this._map,"mouseup",this._handleMouseUp,this),this._map.fire("dialog:movestart",this),this._moving=!0},_handleMouseMove:function(i){var t=i.originalEvent.clientX-this._oldMousePos.x,e=i.originalEvent.clientY-this._oldMousePos.y;i.originalEvent.stopPropagation&&i.originalEvent.stopPropagation(),i.originalEvent.preventDefault&&i.originalEvent.preventDefault(),this._resizing&&this._resize(t,e),this._moving&&this._move(t,e)},_handleMouseUp:function(){L.DomEvent.off(this._map,"mousemove",this._handleMouseMove,this),L.DomEvent.off(this._map,"mouseup",this._handleMouseUp,this),this._resizing&&(this._resizing=!1,this._map.fire("dialog:resizeend",this)),this._moving&&(this._moving=!1,this._map.fire("dialog:moveend",this))},_move:function(i,t){var e=this.options.anchor[0]+t,o=this.options.anchor[1]+i;this.options.anchor[0]=e,this.options.anchor[1]=o,this._container.style.top=this.options.anchor[0]+"px",this._container.style.left=this.options.anchor[1]+"px",this._map.fire("dialog:moving",this),this._oldMousePos.y+=t,this._oldMousePos.x+=i},_resize:function(i,t){var e=this.options.size[0]+i,o=this.options.size[1]+t;e<=this.options.maxSize[0]&&e>=this.options.minSize[0]&&(this.options.size[0]=e,this._container.style.width=this.options.size[0]+"px",this._oldMousePos.x+=i),o<=this.options.maxSize[1]&&o>=this.options.minSize[1]&&(this.options.size[1]=o,this._container.style.height=this.options.size[1]+"px",this._oldMousePos.y+=t),this._map.fire("dialog:resizing",this)},_updateContent:function(){if(this._content){var i=this._contentNode,t="function"==typeof this._content?this._content(this):this._content;if("string"==typeof t)i.innerHTML=t;else{for(;i.hasChildNodes();)i.removeChild(i.firstChild);i.appendChild(t)}}},_updateLayout:function(){this._container.style.width=this.options.size[0]+"px",this._container.style.height=this.options.size[1]+"px",this._container.style.top=this.options.anchor[0]+"px",this._container.style.left=this.options.anchor[1]+"px"}}),L.control.dialog=function(i){return new L.Control.Dialog(i)};
