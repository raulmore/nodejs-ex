function createTree(e,t,n){var l={name:"tree",div:e,ulElement:null,childNodes:[],backcolor:t,contextMenu:n,selectedNode:null,nodeCounter:0,contextMenuDiv:null,rendered:!1,createNode:function(e,t,n,l,i,d){if(v_tree=this,node={id:"node_"+this.nodeCounter,text:e,icon:n,parent:l,expanded:t,childNodes:[],tag:i,contextMenu:d,elementLi:null,removeNode:function(){v_tree.removeNode(this)},toggleNode:function(e){v_tree.toggleNode(this)},expandNode:function(e){v_tree.expandNode(this)},expandSubtree:function(){v_tree.expandSubtree(this)},setText:function(e){v_tree.setText(this,e)},collapseNode:function(){v_tree.collapseNode(this)},collapseSubtree:function(){v_tree.collapseSubtree(this)},removeChildNodes:function(){v_tree.removeChildNodes(this)},createChildNode:function(e,t,n,l,i){return v_tree.createNode(e,t,n,this,l,i)}},this.nodeCounter++,this.rendered)if(void 0==l)this.drawNode(this.ulElement,node),this.adjustLines(this.ulElement,!1);else{var o=l.elementLi.getElementsByTagName("ul")[0];0==l.childNodes.length&&(l.expanded?(l.elementLi.getElementsByTagName("ul")[0].style.display="block",v_img=l.elementLi.getElementsByTagName("img")[0],v_img.style.visibility="visible",v_img.src="imagesz/collapse.png",v_img.id="toggle_off"):(l.elementLi.getElementsByTagName("ul")[0].style.display="none",v_img=l.elementLi.getElementsByTagName("img")[0],v_img.style.visibility="visible",v_img.src="images/expand.png",v_img.id="toggle_on")),this.drawNode(o,node),this.adjustLines(o,!1)}return void 0==l?(this.childNodes.push(node),node.parent=this):l.childNodes.push(node),node},drawTree:function(){this.rendered=!0;var e=document.getElementById(this.div);e.innerHTML="",ulElement=createSimpleElement("ul",this.name,"tree"),this.ulElement=ulElement;for(var t=0;t<this.childNodes.length;t++)this.drawNode(ulElement,this.childNodes[t]);e.appendChild(ulElement),this.adjustLines(document.getElementById(this.name),!0)},drawNode:function(e,t){v_tree=this;var n=null;null!=t.icon&&(n=createImgElement(null,"icon_tree",t.icon));var l=document.createElement("li");t.elementLi=l;var i=createSimpleElement("span",null,"node"),d=null;0==t.childNodes.length?(d=createImgElement("toggle_off","exp_col","images/collapse.png")).style.visibility="hidden":d=t.expanded?createImgElement("toggle_off","exp_col","images/collapse.png"):createImgElement("toggle_on","exp_col","images/expand.png"),i.ondblclick=function(){v_tree.doubleClickNode(t)},d.onclick=function(){v_tree.toggleNode(t)},i.onclick=function(){v_tree.selectNode(t)},i.oncontextmenu=function(e){v_tree.selectNode(t),v_tree.nodeContextMenu(e,t)},void 0!=n&&i.appendChild(n),v_a=createSimpleElement("a",null,null),v_a.innerHTML=t.text,i.appendChild(v_a),l.appendChild(d),l.appendChild(i),e.appendChild(l);var o=createSimpleElement("ul","ul_"+t.id,null);if(l.appendChild(o),t.childNodes.length>0){t.expanded||(o.style.display="none");for(var s=0;s<t.childNodes.length;s++)this.drawNode(o,t.childNodes[s])}},setText:function(e,t){e.elementLi.getElementsByTagName("span")[0].lastChild.innerHTML=t,e.text=t},expandTree:function(){for(var e=0;e<this.childNodes.length;e++)this.childNodes[e].childNodes.length>0&&this.expandSubtree(this.childNodes[e])},expandSubtree:function(e){this.expandNode(e);for(var t=0;t<e.childNodes.length;t++)e.childNodes[t].childNodes.length>0&&this.expandSubtree(e.childNodes[t])},collapseTree:function(){for(var e=0;e<this.childNodes.length;e++)this.childNodes[e].childNodes.length>0&&this.collapseSubtree(this.childNodes[e])},collapseSubtree:function(e){this.collapseNode(e);for(var t=0;t<e.childNodes.length;t++)e.childNodes[t].childNodes.length>0&&this.collapseSubtree(e.childNodes[t])},expandNode:function(e){if(e.childNodes.length>0&&0==e.expanded){void 0!=this.nodeBeforeOpenEvent&&this.nodeBeforeOpenEvent(e);var t=e.elementLi.getElementsByTagName("img")[0];e.expanded=!0,t.id="toggle_off",t.src="images/collapse.png",elem_ul=t.parentElement.getElementsByTagName("ul")[0],elem_ul.style.display="block",void 0!=this.nodeAfterOpenEvent&&this.nodeAfterOpenEvent(e)}},collapseNode:function(e){if(e.childNodes.length>0&&1==e.expanded){var t=e.elementLi.getElementsByTagName("img")[0];e.expanded=!1,void 0!=this.nodeBeforeCloseEvent&&this.nodeBeforeCloseEvent(e),t.id="toggle_on",t.src="images/expand.png",elem_ul=t.parentElement.getElementsByTagName("ul")[0],elem_ul.style.display="none"}},toggleNode:function(e){e.childNodes.length>0&&(e.expanded?e.collapseNode():e.expandNode())},doubleClickNode:function(e){this.toggleNode(e)},selectNode:function(e){e.elementLi.getElementsByTagName("span")[0].className="node_selected",null!=this.selectedNode&&this.selectedNode!=e&&(this.selectedNode.elementLi.getElementsByTagName("span")[0].className="node"),this.selectedNode=e},removeNode:function(e){var t=e.parent.childNodes.indexOf(e);"last"==e.elementLi.className&&0!=t&&(e.parent.childNodes[t-1].elementLi.className+="last",e.parent.childNodes[t-1].elementLi.style.backgroundColor=this.backcolor),e.elementLi.parentNode.removeChild(e.elementLi),e.parent.childNodes.splice(t,1),0==e.parent.childNodes.length&&(e.parent.elementLi.getElementsByTagName("img")[0].style.visibility="hidden")},removeChildNodes:function(e){if(e.childNodes.length>0){var t=e.elementLi.getElementsByTagName("ul")[0];e.elementLi.getElementsByTagName("img")[0].style.visibility="hidden",e.childNodes=[],t.innerHTML=""}},nodeContextMenu:function(e,t){if(2==e.button&&(e.preventDefault(),e.stopPropagation(),void 0!=t.contextMenu)){v_tree=this;var n,l=this.contextMenu[t.contextMenu];null==this.contextMenuDiv?(n=createSimpleElement("ul","ul_cm","menu"),document.body.appendChild(n)):n=this.contextMenuDiv,n.innerHTML="";var i=e.pageX-5,d=e.pageY-5;n.style.display="block",n.style.position="absolute",n.style.left=i+"px",n.style.top=d+"px";for(var o=0;o<l.elements.length;o++)!function(e){var i=createSimpleElement("li",null,null),d=createSimpleElement("span",null,null);d.onclick=function(){l.elements[e].action(t)};var o=createSimpleElement("a",null,null),s=createSimpleElement("ul",null,"sub-menu");if(o.appendChild(document.createTextNode(l.elements[e].text)),i.appendChild(d),void 0!=l.elements[e].icon){var a=createImgElement("null","null",l.elements[e].icon);i.appendChild(a)}if(i.appendChild(o),i.appendChild(s),n.appendChild(i),void 0!=l.elements[e].submenu){var c=createSimpleElement("div",null,null);c.appendChild(createImgElement(null,"menu_img","images/right.png")),i.appendChild(c),v_tree.contextMenuLi(l.elements[e].submenu,s,t)}}(o);this.contextMenuDiv=n}},contextMenuLi:function(e,t,n){v_tree=this;for(var l=0;l<e.elements.length;l++)!function(l){var i=createSimpleElement("li",null,null),d=createSimpleElement("span",null,null);d.onclick=function(){e.elements[l].action(n)};var o=createSimpleElement("a",null,null),s=createSimpleElement("ul",null,"sub-menu");if(o.appendChild(document.createTextNode(e.elements[l].text)),i.appendChild(d),void 0!=e.elements[l].icon){var a=createImgElement("null","null",e.elements[l].icon);i.appendChild(a)}if(i.appendChild(o),i.appendChild(s),t.appendChild(i),void 0!=e.elements[l].p_submenu){var c=createSimpleElement("div",null,null);c.appendChild(createImgElement(null,"menu_img","images/right.png")),i.appendChild(c),v_tree.contextMenuLi(e.elements[l].p_submenu,s,n)}}(l)},adjustLines:function(e,t){var n=e,l=[];if(n.childNodes.length>0&&(l=[n],t))for(d=0;d<n.getElementsByTagName("ul").length;d++){var i=n.getElementsByTagName("ul")[d];0!=i.childNodes.length&&(l[l.length]=i)}for(var d=0;d<l.length;d++){for(var o=l[d].lastChild;!o.tagName||"li"!=o.tagName.toLowerCase();)o=o.previousSibling;o.className+="last",o.style.backgroundColor=this.backcolor,null!=(o=o.previousSibling)&&"li"==o.tagName.toLowerCase()&&(o.className="",o.style.backgroundColor="transparent")}}};return window.onclick=function(){null!=l.contextMenuDiv&&(l.contextMenuDiv.style.display="none")},l}function createSimpleElement(e,t,n){return element=document.createElement(e),void 0!=t&&(element.id=t),void 0!=n&&(element.className=n),element}function createImgElement(e,t,n){return element=document.createElement("img"),void 0!=e&&(element.id=e),void 0!=t&&(element.className=t),void 0!=n&&(element.src=n),element}
